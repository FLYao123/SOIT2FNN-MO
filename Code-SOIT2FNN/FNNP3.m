%---------------------------------
% IT2FNNP1  : Single-optput Parallel prediction scheme (PM)
% IT2FNNP2 : Single-optput serial prediction scheme (SW)
% IT2FNNP3  : Multi-optput  prediction scheme (MO)
%---------------------------------
clc;
clear all;
close all;

% % รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยฆรฦรยขรยขรขโฌลกรยฌรยขรข?ลพรยขรฦรโรโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฎรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร????รฦรขโฌลกรโ?รยบรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยนรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยทรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยพรฦรโ?ร????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยฆรฦรขโฌลกรโรยกรฦรโ?ร????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?ร???รฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลร????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร?????
subfolder_data = 'IT2FNN_normalization_data';

% % รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยฆรฦรขโฌลกรโรยพรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆร?????รฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลร????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร??????
filename_train = fullfile(subfolder_data, 'unmets_HWM_train.mat');
load(filename_train)
inputs = trainData(:, 4:15);
X = inputs(:,1:9);
Y = inputs(:,10:12);
% plot(X(:,1))
% % % รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยฆรฦรขโฌลกรโรยพรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆร?????รฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลร????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร??????
% filename_train = fullfile(subfolder_data, 'Chaotic_train_9_3_0.300000.mat');
% load(filename_train)
% X = train_input';
% Y = train_output';

%% Clustering 
%---------------------------------
% Cnum : the number of expected clusterings
% Ctype=1 : K-means
% Ctype=2 : Gaussian Mixture Model รฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยGMMรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกร???
% Ctype=3รฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกร??? Fuzzy C means (FCM)
% Ctype=4 : Possibilistic C-Means รฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยPCMรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกร???
% Ctype=5 : Possibilistic Fuzzy C-Meansรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยPFCMรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกร???
% Ctype=6 : Enhanced Possibilistic Fuzzy C-Meansรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยEPFCMรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกร???
% Ctype=7 : Interval Type 2 Possibilistic Fuzzy C-Meansรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยIT2-EPFCMรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกร???
%---------------------------------
Ctype = 3;
Cnum = 5; % 10, 15, 20, 25, 30, ...
% % % % % ******* CLUSTERING  & SAVE for inputs******
% [C_x] = clustering (X, Ctype, Cnum);
% % % save('prs_9_3_clustering_FCM_5.mat', 'C_x');
% save('Chaotic_9_3_clustering_FCM_5_0.3.mat', 'C_x');
% 
% % % % % % % ******* CLUSTERING  & SAVE for inputs******
% [C_mid] = clustering (X, Ctype, 1);
% % save('prs_9_3_clustering_FCM_10_mid.mat', 'C_mid');
% save('Chaotic_9_3_clustering_FCM_mid_0.0.mat', 'C_mid');
%% ******* CLUSTERING  & LOADING******
% % load('clustering_FCM_10.mat');
% load('pr_8_2_clustering_FCM_5.mat');
% load('pr_8_2_clustering_FCM_mid.mat');
% 
% filename_cluster = fullfile(subfolder_data, 'unmets_9_3_clustering_FCM_5.mat');
% filename_cluster_mid = fullfile(subfolder_data, 'unmets_9_3_clustering_FCM_10_mid.mat');
filename_cluster = fullfile(subfolder_data, 'Chaotic_9_3_clustering_FCM_5_0.3.mat');
filename_cluster_mid = fullfile(subfolder_data, 'Chaotic_9_3_clustering_FCM_mid_0.0.mat');
load(filename_cluster);
load(filename_cluster_mid);

% load('unmet_9HWM_3_clustering_FCM_8.mat');
% load('unmet_9HWM_3_clustering_FCM_8_mid.mat');
% C_x = C;
% cl=ca(ctype,trndat,cnum); % do the cluster analysis
I = size(X,2);
M = size(Y,2);

% %% ****Unify the cluster center and variance of multi-dimensions*****************
% row_means = mean(C.center, 2);
% C.center = repmat(row_means, 1, size(C.center, 2)); % รฦรโรโ?รขโฌโขรฦร??ลกรโรยงรฦรโ?รโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦรขโฌลกรโรยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยจรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยคร??????รฦรโรโ?รขโฌโขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยกรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยนรฦรโ?ร???รยกรฦรขโฌลกรโ?รยณรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร????รฦรขโฌลกรโ?รยบรฦรโ?รโ?ร???รฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลรฦรโรโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฅรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยญรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกร?????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?ร???รฦรขโฌลกรโ?รยฐรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยฆรฦ??รโฆรขโฌลรฦรโรโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌลกรโ?รยฆรฦรโ?รยขรขโ?ยฌรยรฦรยขรยขรขโฌลกรยฌรยขรข?ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยงร??????

%% Initialize the antecedent parameters (Convert the clustering parameters to interval MF)

uncertainty = 0.1;
c_up = C_x.center * (1+uncertainty); % Cnum * I 
c_lo = C_x.center * (1-uncertainty);
c_mid = C_mid.center;% 1 * I 
sigma = C_x.std; % Cnum * I 
sigma_mid = C_mid.std; % 1 * I 

buffer_size = size(c_lo,1);
Rule_num = 0; % รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยนรฦรยขรยขรขโฌลกรยฌรโรยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยนรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขร????รฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลรฦรโรโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธร?????0รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦ??รโรยรฦรโ?รโ?รยขรฦรย??รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยณรฦรโ?ร???รยกรฦรขโฌลกรโ?รยจรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยพรฦร??ลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยรฦ??รยขรขโฌลพรยขรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรยขรย??รยพรโรยขรฦรโ?รย??รยฆรฦ??รยขรขโฌลพรยขRule_growingรฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยญรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพrule_numรฦรโรโ?รขโฌโขรฦร??ลกรโรยงรฦรโ?รโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦรขโฌลกรโรยบรฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆร?????รฦรขโฌลกรโ?รยบรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฟรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฎรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦรขโฌลกรโรยฆรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยrule_num = Rule_num +1,รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦรขโฌลกรโรยบรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦ??รโฆรขโฌลรฦรโรยขรขโ?ยฌรยกรฦรขโฌลกรโรยจรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌลกรโ?รยกรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร????รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?ร????รฦรขโฌลกรโ?รยกรฦรโ?รยขรขโ?ยฌรยฆรฦรยขรยขรขโฌลกรยฌรยขรข?ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฉรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฎรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦรขโฌลกรโรยฆรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฎรฦรโ?ร???รยกรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยทรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร??????
ant_par = [];
con_par = [];
% stage2_flag = 0; % รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยนรฦรยขรยขรขโฌลกรยฌรโรยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรยขรยขรขโฌลกรยฌรโฆร??ลรฦรโรยขรขโ?ยฌรยกรฦรขโฌลกรโรยญรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยญรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟร?????รฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?ร???รฦรขโฌลกรโ?รยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฅstage2รฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยณstage 2 รฦรโรโ?รขโฌโขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐรฦรโ?ร???รยรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยงร?????รฦรขโฌยฆรโ?รยพรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฒรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลรฦร???รฦรขโฌลกรโ?รยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยงรฦรโ?ร????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยนรฦรยขรยขรขโฌลกรยฌรโรยรฦรโ?รโ?รยขรฦร???รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยขรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦ??
% change_stage2 = 1; % รฦรโรโ?รขโฌโขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยพรฦร??ลกรโรยขchange_stage1รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกstage2รฦรโรโ?รขโฌโขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐรฦรโ?ร???รยรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลรฦรโรยขรขโ?ยฌรยกรฦรขโฌลกรโรยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฆร?????รฦรขโฌยฆรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยฆรฦรขโฌลกรโรยพรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลchange_stage1รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยนรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยนรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยพรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยงร?????รฦรขโฌยฆรโ?รยพรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฒรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลรฦร???รฦรขโฌลกรโ?รยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยงรฦรโ?ร????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยนรฦรยขรยขรขโฌลกรยฌรโรยรฦรโ?รโ?รยขรฦร???รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยขรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆร??รโรฦรโ?รโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยธรฦรโ?รโ?ร??โขรฦร??ลกรโรยฃรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?รโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦรขโฌยฆรโรยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลรฦรโรยขรขโ?ยฌรยกรฦรขโฌลกรโรยชRule_num รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยทรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฒรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆร???????
% Mqlqr = [0.5,0.5;0.5,0.5]; % ql and qr

Mqlqr = zeros(M, 2) + 0.5;
Mylyr = zeros(1,M) + 0.5;
 
% Mant = [c_mid*ones(M,1), sigma_mid*ones(M,1)];

M_c_mid = repmat(c_mid, M, 1); % M*I
M_sigma_mid = repmat(sigma_mid, M, 1);% M*I
Mant = cat(3, M_c_mid, M_sigma_mid); % รฦรโรโ?รขโฌโขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦ???? Mรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏIรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌยฆรยขรขโ?ยฌรโ?รฦรโ?รย??รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร??????รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆร???????

res_last = 1000; %รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยนรฦรยขรยขรขโฌลกรยฌรโรยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยนรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขร????รฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลรฦรโรโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยคร??????รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยพรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร??????
threshold_growing = 0.0025; %0.0001
threshold_reducing = threshold_growing*1; %

K_link = 0.1;
Flag = 0; % 0รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยนรฦรโ?ร??????; 1รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦ??รโรยรฦรโ?รโ?รยขรฦรย??รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยขรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦ???; 2รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦ??รโรยรฦรโ?รโ?รยขรฦรย??รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦรขโฌลกรโรยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร??????; 3รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦ??รโรยรฦรโ?รโ?รยขรฦรย??รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยทรฦรโ?ร???รยกรฦรขโฌลกรโ?รยณรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐstage2รฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรยขรยขรขโฌลกรยฌรโฆร??ลรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌลกรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยพรฦร??ลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦ????รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลรฦรโรยขรขโ?ยฌรยกรฦรขโฌลกรโรยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦ???; 4รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยญรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยจรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยณรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฎรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขร????รโฆรยกรฦรขโฌลกรโรยฌรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยณรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆร??รโรฦรโ?รโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?ร??????

lr = 0.03; % learning rate for stage 2
ep_max = 5000; % maximum episode for stage 2 , 5000
batch_size = 64; % batch size for stage 2
replay_momory = [];% รฦรโรโ?รขโฌโขรฦร??ลกรโรยงรฦรโ?รโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦรขโฌลกรโรยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยจรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยญรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รโ?รขโฌโขรฦร??ลกรโรยฆร?????รฦรขโฌลกรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌลกรโ?รยบรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบrule_growingรฦรโรโ?รขโฌโขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยขรฦรโ?ร???รยกรฦรขโฌลกรโ?รยซรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยครฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกร?????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฑรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฅรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยพรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยญrule_decreasingรฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦ???รโรยรฦรโ?รยขรขโ?ยฌรยกรฦร??ลกรโรยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌลกรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?ร?????

tic;%total time
for epo = 1:100
    % loss = zeros(1,size(c_up,1));
    % res = zeros(1,size(c_up,1));
    con_par_stage1 = [];
    Mqlqr_growing = [];
    Mylyr_growing = [];
    Mant_growing = [];
    K_link_growing = [];
    res = zeros(1,size(c_up,1));

    if isempty(c_up)
       break;
    end

% ****** First stage: Rule growing ******
    for i = 1:size(c_up,1) %รฦรโรโ?รขโฌโขรฦร??ลกรโรยฉรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงร?????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยนรฦรยขรยขรขโฌลกรยฌรโรยรฦรโ?รโ?รยขรฦร???รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขร????รโฆรยกรฦรขโฌลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขร????รโฆรยกรฦรขโฌลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยบรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฑรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?รโ?ร??โขรฦร??ลกรโรยคร??????
        
        seed = 42;
        rng(seed);
        % ***********รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยฆรฦรยขรยขรขโฌลกรยฌรยขรข?ลพรยขรฦรโรโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฑรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฅรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฉรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยฆรฦ??รโฆรขโฌลรฦรโรยขรขโ?ยฌรยกรฦรขโฌลกรโรยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยทรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รโ?รขโฌโขรฦร??ลกรโรยฉรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยรฦ??รยขรขโฌลพรยขรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฆรฦรโ?รโ?ร??โขรฦร??ยร??รขโยขร?????รฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?ร??โขรฦร??ยร??รขโยขร?????รฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?ร??โขรฦร??ยร??รขโยขร?????รฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?ร??โขรฦร??ยร??รขโยขร?????รฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?ร??โขรฦร??ยร??รขโยขร?????รฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?ร??โขรฦร??ยร??รขโยขร?????รฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?ร??โขรฦร??ยร??รขโยขร?????รฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?ร??โขรฦร??ยร??รขโยขร?????รฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?ร??โขรฦร??ยร??รขโยขร?????รฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?ร??โขรฦร??ยร??รขโยขร?????รฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?ร??โขรฦร??ยร??รขโยขร?????รฦรยขรยขรขโฌลกรยฌรโ?รยร??????
        ant_tmp_tuple= cat(3, c_lo(i,:), c_up(i,:), sigma(i,:));

        c = randn(I + 1, M);
        s = randn(I + 1, M);
        con_tmp_tuple = cat(3, c,s); % รฦรโรโ?รขโฌโขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦ???? I+1รฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏMรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌยฆรยขรขโ?ยฌรโ?รฦรโ?รย??รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร??????รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆร???????

        if isempty(ant_par) ==1
            ant_par_tmp = ant_tmp_tuple;
            con_par_tmp = con_tmp_tuple;
        else
            ant_par_tmp = cat(4, ant_par,ant_tmp_tuple);%รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦรขโฌลกรโรยบร?????รฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร????รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฎรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌลกรโ?รยฐรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร????รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธร?????รฦรขโฌลกรโ?รยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌยฆรยขรขโ?ยฌรโ?รฦรโ?รย??รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร????รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฆร??????รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌยฆรยขรขโ?ยฌรโ?รฦรโ?รย??รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยนรฦ??รโรยRULEรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยณรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏร??????1*I *3 * rule_num
            con_par_tmp = cat(4, con_par,con_tmp_tuple);%รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦรขโฌลกรโรยบร?????รฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร????รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฎรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌลกรโ?รยฐรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร????รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธร?????รฦรขโฌลกรโ?รยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌยฆรยขรขโ?ยฌรโ?รฦรโ?รย??รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร????รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฆร??????รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌยฆรยขรขโ?ยฌรโ?รฦรโ?รย??รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยนรฦ??รโรยRULEรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยณรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏร??????(I +1)*M *2 *rule_num
        end

        % ***computing the consequent parameters using 
        [res_tmp, con_par_tmp, Mqlqr_tmp,Mylyr_tmp,Mant_tmp,K_link_tmp] = Rule_growing(X,Y, ant_par_tmp,Mant, con_par_tmp,Mqlqr,I,M, K_link,Mylyr); %รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยธรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยฑรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆร?????รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ย??? รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขรยขรขโ?ย????? รฦรโรโ?รขโฌโขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦ??รโรยรฦรโ?รโ?รยขรฦรย??รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?รโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦรขโฌลกรโรยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร????? รฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฟรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกร?????รฦรขโฌยฆรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?ร???รฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยร?????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฎรฦรโ?ร???รยกรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยคร??????รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร???รฦรขโฌลกรโ?รยscore_tmpรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกร???
%         [res_tmp, con_par_tmp, Mqlqr] = Rule_growing_adam(X,Y, ant_par_tmp,con_par_tmp,Mqlqr,I,M, ep_max_stage1,batch_size);%รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยธรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยฑรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆร?????รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ย??? รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขรยขรขโ?ย????? รฦรโรโ?รขโฌโขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦ??รโรยรฦรโ?รโ?รยขรฦรย??รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?รโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦรขโฌลกรโรยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร????? รฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฟรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกร?????รฦรขโฌยฆรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?ร???รฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยร?????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฎรฦรโ?ร???รยกรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยคร??????รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร???รฦรขโฌลกรโ?รยscore_tmpรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกร???
        % loss(i) = loss_tmp;  
        res(i) = mean(res_tmp); 
        con_par_stage1 = cat(5,con_par_stage1, con_par_tmp); %รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦ???รโรยรฦรโ?รยขรขโ?ยฌรยกรฦร??ลกรโรยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยญรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รโ?รขโฌโขรฦร??ลกรโรยฅร?????รฦรขโฌยฆรโ?รยกรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยจรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร??????รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยฆรฦรยขรยขรขโฌลกร???
        Mqlqr_growing = cat(3,Mqlqr_growing,Mqlqr_tmp);  
%         Mylyr_growing = cat(3,Mylyr_growing,Mylyr_tmp); 
        Mant_growing  = cat(4,Mant_growing,Mant_tmp);
        K_link_growing = cat(2,K_link_growing,K_link_tmp);
    end
    
    % *******รฦรโรโ?รขโฌโขรฦร??ลกรโรยฉรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌร?????รฦรขโฌลกรโ?รยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?ร???รฦรขโฌลกรโ?รยนรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฉรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฝรฦรโ?ร????รฦรขโฌยฆรยขรขโ?ยฌรโ?รฦรโ?รโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌลกรโ?รยฐรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยepochรฦรโรโ?รขโฌโขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฉรฦรโ?ร???รยกรฦรขโฌลกรโ?รยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยซรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยธรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยขรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยนรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌยฆรยขรขโ?ยฌรโ?รฦรโ?รย??รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฑรฦรโ?ร?????,รฦรโรโ?รขโฌโขรฦร??ลกรโรยงรฦรโ?รโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦรขโฌยฆรโรยพรฦรโ?ร???รยกรฦรขโฌลกรโ?รยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦ??รโรยรฦรโ?รยขรขโ?ยฌรยกรฦร??ลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยครฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฅรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฑรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยฐรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฉรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร????รฦรขโฌลกรโ?รยนรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยฆรฦรขโฌลกรโรยกรฦรโ?ร????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฑรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยญepoch*********
    [minres, index] = min(res); 
    rule_growing_res(epo) = res(index);
    % [maxscore, index] = max(score); % ????รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยฆรฦรยขรยขรขโฌลกรยฌรโฆร??ลรฦรโรยขรขโ?ยฌรยกรฦรขโฌลกรโรยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฎรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฎรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยญรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร?????รฦรโรยขรขโ?ยฌรยกรฦร??ลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกร????,รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโร???รยกรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยบรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฅรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร????รฦรขโฌลกรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยจmseรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยนรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยธรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยรฦ??รยขรขโฌลพรยขรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยจรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?ร????รฦรขโฌลกรโ?รยกรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร?????รฦรโรยขรขโ?ยฌรยกรฦร??ลกรโรยงรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกร?????รฦรขโฌยฆรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?ร???รฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยร?????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฎรฦรโ?ร???รยกรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยคร??????รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยญรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรยขรยขรขโฌลกรยฌรโฆร??ลรฦรโรโ?ร??โขรฦร??ลกรโรยงรฦร????รฦรขโฌลกรโ?รยบรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฎรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌลกรโ?รยฐรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฎรฦรโ?ร???รยกรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏmaxรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฝรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆร??รโรฦรโ?รโ?รขโฌโขรฦร??ลกรโรยงรฦรโ?ร????รฦรขโฌยฆรโ?รยพรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยนรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยธรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโร???รยกรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏminรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยนรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฎรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร???รฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฟรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฎรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร????รฦรขโฌลกรโ?รยรฦรโ?รยขรขโ?ย???

    if (res_last - minres) >= threshold_growing % รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยญรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦ???รโรยรฦรโ?รยขรขโ?ยฌรยกรฦร??ลกรโรยถgrowing rule  รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยนรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยธรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฅรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรยขรยขรขโฌลกร???? abs(res_last - minres)>= threshold_growingรฦรโรโ?รขโฌโขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฏรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขร????รโฆรยกรฦรขโฌลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦ????
        ant_tuple= cat(3, c_lo(index,:), c_up(index,:), sigma(index,:));
        ant_par = cat(4, ant_par,ant_tuple);
        con_par = con_par_stage1(:,:,:,:,index);
        Mqlqr = Mqlqr_growing(:,:,index);
%         Mylyr = Mylyr_growing(:,:,index);
        Mant = Mant_growing(:,:,:,index);
        K_link = K_link_growing(:,index);
        Rule_num = Rule_num +1;
        Flag = 1;
        res_last = minres;



    else % รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยญรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦ???รโรยรฦรโ?รยขรขโ?ยฌรยกรฦร??ลกรโรยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงร?????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยนรฦรยขรยขรขโฌลกรยฌรโรยรฦรโ?รโ?รยขรฦร???รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยณรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยฝรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขร?????รฦรขโฌยนรโ?ฆร??ลรฦรโรโ?ร??โขรฦร??ลกรโรยฉรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?ร????รฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ย????รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยทรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฒรฦรโ?รโ?ร??โขรฦร??ลกรโรยงร?????รฦรขโฌยฆรโ?รยพรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌลกรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦ??รโรยรฦรโ?รโ?รยขรฦรย??รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦ????รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยนรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?ร???รยรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆร?????รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร????รฦรขโฌยฆรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?ร???รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?ร???รยรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยขรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌลกรโ?รยฐรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร??????รฦรโรโ?รขโฌโขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยตรฦรโ?ร???รยกรฦรขโฌลกรโ?รยทรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?ร???รยรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโ????
        if size(ant_par,4) == 0 || size(ant_par,4) == 1
            % flag_rule_reducing = 1;%รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยญรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦ???รโรยรฦรโ?รยขรขโ?ยฌรยกรฦร??ลกรโรยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงร?????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยนรฦรยขรยขรขโฌลกรยฌรโรยรฦรโ?รโ?รยขรฦร???รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦร????รฦรขโฌลกรโ?รยบรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฑรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?รยขรฦร???รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฅรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦ??รโรยรฦรโ?รยขรขโ?ยฌรยกรฦร??ลกรโรยฐstage2 รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกร???
            if Flag == 3 
                Flag = 4;% รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?รยขรฦรยขร???รยกรโรยฌรฦรยขรยขรขโฌลกรยฌรโฆร??ลรฦรโรโ?ร??โขรฦร??ลกรโรยครฦร?????รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยณรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยญรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌลกรโ?รยกรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦ??รโรยรฦรโ?รโ?รยขรฦรย??รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยฆรฦรขโฌลกรโรยฝรฦรโ?ร???รยกรฦรขโฌลกรโ?รยจรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยFlag=4รฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกร???
            else
                Flag =3; % รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยญรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦ???รโรยรฦรโ?รยขรขโ?ยฌรยกรฦร??ลกรโรยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌลกรโ?รยกรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฉรฦรโ?ร???รยฆรฦ??รโฆรขโฌลรฦรโรโ?รยขรฦร???รโฆรยกรฦรขโฌลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌลกรโ?รยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฅstage2 รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?รยขรฦรยขร???รยกรโ???
            end
        else
            [res_reducing_tmp, rule_reducing_index, Mqlqr_red, con_par_red,Mylyr_red,Mant_red,K_link_red] = Rule_Reducing(X,Y, ant_par,con_par,Mqlqr,I,M,res_last,Mant, K_link,Mylyr); % รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยณรฦรโ?ร???รยกรฦรขโฌลกรโ?รยจรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐร?????รฦรขโฌยนรโ?ฆร??ลรฦรโรโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร??????,รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌลกรโ?รยบรฦรโ?รยขรขโ?ยฌรยฆรฦรขโฌลกรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชres_tmp
         
            if res_reducing_tmp - res_last > threshold_reducing % รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยนรฦรยขรยขรขโฌลกรยฌรโรยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยครฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?รยขรฦร???รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฎรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦร????รฦรขโฌลกรโ?รยฆรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฝรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฑรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌยฆรยขรขโ?ยฌรโ?รฦรโ?รย??รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยพรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦ??รโรยรฦรโ?รโ?รยขรฦรย??รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฅรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦ??รโรยรฦรโ?รยขรขโ?ยฌรยกรฦร??ลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦร????
                 if Flag == 3 
                     Flag = 4;% รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?รยขรฦรยขร???รยกรโรยฌรฦรยขรยขรขโฌลกรยฌรโฆร??ลรฦรโรโ?ร??โขรฦร??ลกรโรยครฦร?????รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยณรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยญรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌลกรโ?รยกรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦ??รโรยรฦรโ?รโ?รยขรฦรย??รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยฆรฦรขโฌลกรโรยฝรฦรโ?ร???รยกรฦรขโฌลกรโ?รยจรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยFlag=4รฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกร???
                 else
                     Flag =3; % รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยญรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦ???รโรยรฦรโ?รยขรขโ?ยฌรยกรฦร??ลกรโรยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌลกรโ?รยกรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฉรฦรโ?ร???รยฆรฦ??รโฆรขโฌลรฦรโรโ?รยขรฦร???รโฆรยกรฦรขโฌลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌลกรโ?รยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฅstage2 รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?รยขรฦรยขร???รยกรโ???
                 end
            else % รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฆรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รโ?รยขรฦร???รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฅรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงร?????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยนรฦรยขรยขรขโฌลกรยฌรโรยรฦรโ?รโ?รยขรฦร???รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยนรฦ??รโรยรฦรโ????รฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลร?????รฦรโรโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦร??ลกรโรยฆรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยตรฦรโ?ร???รยกรฦรขโฌลกรโ?รยทรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦ??รโรยรฦรโ?รยขรขโ?ยฌรยกรฦร??ลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยฝรฦรโ?ร???รยฆรฦ??รโฆรขโฌลรฦรโรโ?ร??โขรฦร??ลกรโรยงรฦร????รฦรขโฌลกรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยจรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฉร??????รฦรโรโ?รขโฌโขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦรยขรยขรขโฌลกรยฌรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยครฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร??????
               c_up(end+1,:) =  replay_momory(:,:,1,rule_reducing_index);
               c_lo(end+1,:) = replay_momory(:,:,2,rule_reducing_index);
               sigma(end+1,:) = replay_momory(:,:,3,rule_reducing_index);
               ant_par(:, :, :, rule_reducing_index) = [];
               % con_par(:, :, :, rule_reducing_index) = [];
               con_par = con_par_red;               
               Mqlqr = Mqlqr_red;
%                Mylyr = Mylyr_red;
               Mant = Mant_red;
               K_link = K_link_red;

               res_last = res_reducing_tmp;
               Rule_num = Rule_num - 1;
               % stage2_flag = 0;
               Flag = 2;
            end        
        end
    end
    % if flag_rule_reducing == 1%รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยญรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦ???รโรยรฦรโ?รยขรขโ?ยฌรยกรฦร??ลกรโรยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงร?????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยนรฦรยขรยขรขโฌลกรยฌรโรยรฦรโ?รโ?รยขรฦร???รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยนรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยธรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌลกรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌลกรโ?รยกรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?ร????รฦรขโฌยนรโ?ฆร??ลรฦรโรโ?ร??โขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦ??รโรยรฦรโ?รโ?รยขรฦรย??รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦ????รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยนรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?ร???รยรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆร?????รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร????รฦรขโฌยฆรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?ร???รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?ร???รยรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยขรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌลกรโ?รยฐรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร??????รฦรโรโ?รขโฌโขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยตรฦรโ?ร???รยกรฦรขโฌลกรโ?รยทรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?ร???รยรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโ???? 
    if Flag == 3 || Rule_num == Cnum%รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยญรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦ???รโรยรฦรโ?รยขรขโ?ยฌรยกรฦร??ลกรโรยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงร?????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยนรฦรยขรยขรขโฌลกรยฌรโรยรฦรโ?รโ?รยขรฦร???รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยนรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยธรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌลกรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌลกรโ?รยกรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?ร????รฦรขโฌยนรโ?ฆร??ลรฦรโรโ?ร??โขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยนรฦ??รโรยรฦรโ?รโ?รยขรฦรย??รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦ????รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยนรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?ร???รยรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆร?????รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร????รฦรขโฌยฆรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?ร???รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?ร???รยรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยขรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌลกรโ?รยฐรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร??????รฦรโรโ?รขโฌโขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยตรฦรโ?ร???รยกรฦรขโฌลกรโ?รยทรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?ร???รยรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโ???? 
        [ant_par_t,Mant_t,con_par_t,Mqlqr_t,Mylyr_t,K_link_t, loss] = stage2_all_pars_tuning(X, Y, ant_par,Mant,con_par,Mqlqr,I,M,lr, ep_max,batch_size, K_link,Mylyr);   % Stage 2 รฦรโรโ?รขโฌโขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐรฦรโ?ร???รยรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?รยขรฦรยขร???รยกรโ???
        if loss(end) > res_last
            msgbox('Stage2 does not work! Please have a check! Keep the previous record!', 'Warning!');
        else
	        if  res_last - loss(end)<threshold_growing
               msgbox('Stage 2 does not work well! A little help! Maybe not better than add a new rule','Warning!');
            end
            ant_par = ant_par_t;
            Mant = Mant_t;
            con_par = con_par_t;
            Mqlqr = Mqlqr_t;
%             Mylyr = Mylyr_t;
            K_link = K_link_t;

            res_last = loss(end);
        end
    end

    if Flag == 1 % 
        replay_momory_tmp = cat(3, c_up(index,:),  c_lo(index,:),sigma(index,:));
        c_up(index,:) = []; % รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยขรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฎรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยญรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยทรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฒรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรยขรยขรขโฌลกรยฌรโฆร??ลรฦรโรโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฟร?????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยฆรฦรขโฌลกรโรยกรฦรโ?ร????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร?????รฦรโรยขรขโ?ยฌรยกรฦร??ลกรโรยผรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยณรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆร?????รฦรขโฌลกรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌลกรโ?รยบรฦรโ?รยขรขโ?ยฌรยฆรฦรขโฌลกรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร????รฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลร??????
        c_lo(index,:) = []; % รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยขรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฎรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยญรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยทรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฒรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรยขรยขรขโฌลกรยฌรโฆร??ลรฦรโรโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฟร?????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยฆรฦรขโฌลกรโรยกรฦรโ?ร????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร?????รฦรโรยขรขโ?ยฌรยกรฦร??ลกรโรยผรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยณรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆร?????รฦรขโฌลกรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌลกรโ?รยบรฦรโ?รยขรขโ?ยฌรยฆรฦรขโฌลกรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร????รฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลร??????
        sigma(index,:) = []; % รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยขรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฎรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยญรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?รโ?ร??โขรฦร??ลกรโรยฉรฦรโ?รโ?รยขร????รโฆรยพรฦรขโฌลกรโรยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยทรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฒรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรยขรยขรขโฌลกรยฌรโฆร??ลรฦรโรโ?ร??โขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฟร?????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยฆรฦรขโฌลกรโรยกรฦรโ?ร????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร?????รฦรโรยขรขโ?ยฌรยกรฦร??ลกรโรยผรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยณรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆร?????รฦรขโฌลกรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร????รฦรขโฌลกรโ?รยบรฦรโ?รยขรขโ?ยฌรยฆรฦรขโฌลกรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร????รฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลร??????
        replay_momory = cat(4,replay_momory, replay_momory_tmp); %  รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยบรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยดรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยขรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร????? * รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦรขโฌยฆร??รโรฦรโ?รย??รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?รโ?รยขร????รโฆรยกรฦรขโฌลกรโรยฌรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยฆรฦรโ?ร???รยรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยงร?????? * rule_num

    elseif Flag == 4 % รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยญรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦ???รโรยรฦรโ?รยขรขโ?ยฌรยกรฦร??ลกรโรยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยผรฦรโ?ร???รยฆรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยณรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยฝรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟstage2รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขรยขร??ลกรยฌรโฆรยกรฦร??ลกรโรยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฐรฦรโ?ร???รยรฦ??รยขรขโฌลพรยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅร??????2รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฌรฦรโ?ร???รยกรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยนรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยนรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยนรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยธรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยพรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยงร?????รฦรขโฌยฆรโ?รยพรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโร???รยกรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅร?????รฦรขโฌลกรโ?รยรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยruleรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยผรฦรโ?ร???รยฆรฦรยขรยขรขโฌลกรยฌรยขร??ลพรยขรฦรโรโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฎรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยทรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฒรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยรฦรโ?ร???รยกรฦรขโฌลกรโ?รยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร??????
        break;
    end

rule_number(epo) = Rule_num;

end

% disp(rule_growing_res)
total_time = toc;
disp(['total training time costs: ', num2str(total_time)]);

% disp(loss(end))
figure(100)
plot(rule_number)

if Rule_num ~= Cnum
    figure(1)
    plot(loss)
else
    disp('Cnum = Rule_num');
    disp(loss(end))
end

% รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยฆรฦรยขรยขรขโฌลกรยฌรยขรข?ลพรยขรฦรโรโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฎรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร????รฦรขโฌลกรโ?รยบรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฏรฦรโ?ร???รยกรฦรขโฌลกรโ?รยนรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?ร???รยกรฦรขโฌลกรโ?รยทรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฏรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยพรฦรโ?ร????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รยขรขโ?ยฌรยฆรฦรขโฌลกรโรยกรฦรโ?ร????รฦรขโฌยฆรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?รโ?ร???รฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลร????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?ร?????
subfolder_weights = 'Weights';

% รฦรโรโ?รขโฌโขรฦร??ลกรโรยฆรฦรโ?รยขรขโ?ยฌรยฆรฦรขโฌลกรโรยพรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌยฆรโรยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆร?????รฦรยขรยขรขโฌลกรยฌรโ?ฆร??ลร????รฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยปรฦรโ?ร???รยกรฦรขโฌลกรโ?รยถรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร??????
filename_weights = fullfile(subfolder_weights, sprintf('IT2FNN3_Chaotic_0.3_weights_I%d_M%d_C%d_Tg%2f_Tr%2f.mat', I, M,Cnum,threshold_growing,threshold_reducing));
% filename_weights = fullfile(subfolder_weights, sprintf('IT2FNN3_unmets_weights_I%d_M%d_C%d_Tg%2f_Tr%2f.mat', I, M,Cnum,threshold_growing,threshold_reducing));
% รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฝรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยร????? save รฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขรยขรขโ?ยฌรยกรโ?รยฌรฦรขโฌลกรโรยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฝรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆร?????รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยฟรฦรโ?ร???รยกรฦรขโฌลกรโ?รยรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยญรฦรโ?ร???รยนรฦรขโฌยฆร???รโรฦรโ?รโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?ร???รยฆรฦรขโฌลกรโ?รยกรฦรโ?รโ?ร??โขรฦร??ลกรโรยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยชรฦรโ?รโ?ร??โขรฦร??ลกรโรยฆรฦรโ?ร????รฦรขโฌลกรโ?รยขรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยฐรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยปรฦรโ?ร?????
save(filename_weights, 'ant_par', 'con_par','Mqlqr','Mant','Mylyr', 'K_link','rule_number');

%% IT2FNN Prediction(IT2FNNP)
%---------------------------------
% IT2FNNP1  : Single-optput Parallel prediction scheme
% IT2FNNP2 : Single-optput serial prediction scheme 
% IT2FNNP3  : Multi-optput  prediction scheme 
%---------------------------------

% filename_test = fullfile(subfolder_data, 'unmets_HWM_test.mat'); 
% load(filename_test)
% inputs_test = testData(:, 1:18);
% X_test = inputs_test(:,1:12);
% Y_test = inputs_test(:,13:15);

clc;
close all;
clear all;
subfolder_data = 'IT2FNN_normalization_data';
I = 9;
M = 3;
%% 
% K_link = 0.05;
subfolder_weights = 'Weights';
% filename_weight_loading = fullfile(subfolder_weights, 'IT2FNN3_Chaotic_0.0_weights_I9_M3_C5_Tg0.002500_Tr0.002500.mat');
filename_weight_loading = fullfile(subfolder_weights, 'IT2FNN3_prs_weights_I9_M3_C10_Tg0.001000_Tr0.001000.mat');
load(filename_weight_loading);
% % %%

% %*********************Chaotic only***********************
% filename_test = fullfile(subfolder_data, 'Chaotic_test_9_3_0.000000.mat');
% % filename_test = fullfile(subfolder_data, 'Chaotic_train_9_3_0.300000.mat');
% load(filename_test)
% X_test = test_input';
% Y_test = test_output';
% % X_test = train_input';
% % Y_test = train_output';
% %******************************************************************

%*********************Microgrid clean variables only***********************
filename_test = fullfile(subfolder_data, 'prs_HWM_test.mat');
% filename_test = fullfile(subfolder_data, 'unmets_HWM_train.mat');
load(filename_test)
inputs = testData(:, 4:15);
% inputs = trainData(:, 4:15);
X_test = inputs(:,1:9);
Y_test = inputs(:,10:12);
%******************************************************************


If_normalization = 0; % 1: Normalization' 0: not

[My_y] = IT2FNNP (X_test,ant_par,con_par,Mqlqr,I,Y_test,Mant, K_link,Mylyr);

% plot(My_y(:,1), 'r--', 'LineWidth', 2);
%% Visualization & Error

mse = mean((My_y - Y_test)'.^2, 2); % Y_batchรฦรโรโ?รขโฌโขรฦร??ลกรโรยฅรฦรโ?รโ?รยขรฦรยขรยขรขโ?ย????? M_y รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกร??? batch_size*Mรฦรโรโ?รขโฌโขรฦร??ลกรโรยฏรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกร??? sum((Y_batch' - M_y).^2, 2)รฦรโรโ?รขโฌโขรฦร??ลกรโรยครฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยธรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบM*1; 
disp('loss(mse): ');
disp(mse)

rmse = sqrt(mse);

disp('rmse:')
disp(rmse)

filename_raw = '2012_Initial_data - unmet.csv';
% filename_raw = '2012_Initial_data-pr.csv';
original_data = csvread(filename_raw);

min_vals = min(original_data);
max_vals = max(original_data);

if If_normalization == 1
Y_back = Y_test*(max_vals-min_vals) + min_vals;  
My_y_back = My_y*(max_vals-min_vals) + min_vals;
else
Y_back = Y_test;  
My_y_back = My_y;
end  

for iii = 1:M

    figure(iii+1)
    plot(Y_back(:,iii), 'b', 'LineWidth', 2);  % 'r-' รฦรโรโ?รขโฌโขรฦร??ลกรโรยจรฦรโ?รยขรขโ?ยฌรยกรฦรขโฌลกรโรยกรฦรโ?ร???รยกรฦรขโฌลกรโ?รยจรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยครฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบรฦรโ?ร???รยกรฦรขโฌลกรโ?รยขรฦรโ?รโ?ร??โขรฦร??ลกรโรยจรฦรโ?รโ?รยขรฦรยขร???รยกรโรยฌรฦรขโฌลกรโรยฐรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฒรฦรโ?รโ?ร??โขรฦร??ลกรโรยฅรฦรโ?ร???รยกรฦรขโฌลกรโ?รยฎรฦรโ?ร???รยฆรฦรขโฌลกรโ?รยพรฦรโ?รโ?ร??โขรฦร??ลกรโรยงรฦรโ?ร???รยกรฦรขโฌลกรโ?รยบร?????
    hold on; 
    plot(My_y_back(:,iii), 'r--', 'LineWidth', 2);
    hold off;

end

disp('mean(rmse):')
disp(mean(rmse))


% %% SAVE For post_processing
% yp_mo = My_y_back;
% ya_mo = Y_back;
% 
% error_mo = ya_mo - yp_mo;
% r_error_mo = abs(ya_mo - yp_mo)./ya_mo;
% 
% 
% subfolder_weights = 'Post_processing';
% filename_results = fullfile(subfolder_weights, 'unmets_results_MO.mat');
% % filename_results = fullfile(subfolder_weights, 'Chaotic_results_MO.mat');
% save(filename_results, 'error_mo','r_error_mo','yp_mo','ya_mo');

